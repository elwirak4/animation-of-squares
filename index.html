<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Flying squares</title>
        <style>
            body {
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
        </style>
    </head>
    <body>
        <script src="js/rAF.js"></script>
        <script src="js/easing.js"></script>
        
        <script>
            var myCanvas = document.createElement('canvas');
            myCanvas.width = window.innerWidth;
            myCanvas.height = window.innerHeight;
            document.body.appendChild(myCanvas);
            var ctx = myCanvas.getContext('2d');

            var allSquares = [];
            var visibleSquares =[];

            //fps =frame per second
            var fps = 50;
            //type of easing for all squares
            var ease = 'easeInOutQuart';
            //animation of rectangle
            var lastTime = 0;
            
            animationLoop();

            function animationLoop(time){
                requestAnimationFrame(animationLoop);

                if(time - lastTime >= 1000/fps){
                    lastTime = time;
                    
                    ctx.clearRect(0, 0, myCanvas.width, myCanvas.height); //clear canvas in every frame
                    visibleSquares.length = 0;

                    for(var i = 0; i<10; i++){
                        allSquares.push({
                            start_x:myCanvas.width/2,
                            start_y:myCanvas.height/2,
                            h:rand(5, 15),
                            //
                            target_r:Math.round(myCanvas.height*0.4),
                            start_a:rand(0, 360),
                            //
                            t:0,    //current time
                            d:2000, //time of animation
                            //
                            start_r:255,
                            start_b:rand(0,240),
                            start_g:rand(0,100)
                        });

                    }

                    for(var i=0; i<allSquares.length; i++){
                        var square = allSquares[i];
                        //growing time
                        square.t += 1000/fps;
                        
                        square.r = Easing.get(ease, 0, square.target_r, square.t, square.d);
                        square.a = Easing.get(ease, square.start_a, square.start_a + 180, square.t, square.d);

                        //change color and position
                        square.x = Math.sin(Math.PI/180 * square.a) * square.r + square.start_x;
                        square.y = Math.cos(Math.PI/180 * square.a) * square.r + square.start_y;

                        square.r = Easing.getRound(ease, square.start_r, 255, square.t, square.d);
                        square.g = Easing.getRound(ease, square.start_g, 255, square.t, square.d);
                        square.b = Easing.getRound(ease, square.start_b, 255, square.t, square.d);

                        ctx.fillStyle = 'rgba('+square.start_r+', '+square.start_g+', '+square.start_b+',1)';

                        ctx.fillRect(square.x-square.h/2, square.y-square.h/2, square.h, square.h); 

                        if(square.t < square.d){
                            visibleSquares.push(square) //visible squares adding to array
                        }

                    }

                    allSquares = visibleSquares.concat();

                }
            }  
            


            function rand(min, max){
                return Math.floor(Math.random()*(max-min + 1) + min);
            }


        
        
        </script>
    </body>
</html>